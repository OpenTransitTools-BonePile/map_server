#
# aerial map tiles
#

services:
  demo:
  wmts:
    restful: true
    restful_template: '/{Layer}-{TileMatrixSet}/{TileMatrix}/{TileCol}/{TileRow}.{Format}'
    kvp: true

layers:
   - name: metro_state_aerials
     title: OR Aerial Tiles
     sources: [or_aerial_cache]

caches:
  or_aerial_cache:
    grids: [webmercator]
    sources: [base_tile, or_tile_source, metro_wms]

    # WMS tiles you can't do have -- meta tiling
    # https://mapproxy.org/docs/nightly/labeling.html
    meta_size: [1, 1]
    meta_buffer: 0

sources:
  base_tile:
    type: tile
    grid: GLOBAL_WEBMERCATOR
    url: http://tile.stamen.com/toner-lite/%(z)s/%(x)s/%(y)s.png
    on_error:
      other:
        response: transparent
        cache: True

  or_tile_source:
    coverage:
      bbox: [-124.633489, 41.932309, -116.428692, 46.317422]
      srs: EPSG:4326
    req:
      layers: '0'
      transparent: false
      url: http://imagery.oregonexplorer.info:80/arcgis/services/NAIP_2016/NAIP_2016_WM/ImageServer/WMSServer
    supported_srs: ['EPSG:3857', 'EPSG:4326']
    type: wms

  metro_wms:
    coverage:
      bbox: [-123.29985, 45.258788, -122.331014, 45.663872]
      srs: EPSG:4326
    req:
      layers: '0'
      transparent: true
      url: https://gis.oregonmetro.gov/arcgis/services/photo/aerialphoto/MapServer/WmsServer?token=
    supported_srs: ['EPSG:3857', 'EPSG:4326']
    type: wms
    image:
      transparent_color: '#ff0000'
      transparent_color_tolerance: 0

grids:
  webmercator:
    base: GLOBAL_WEBMERCATOR
    origin: nw
  coverage:
    bbox: [-124.633489, 41.932309, -116.428692, 46.317422]
    bbox_srs: 'EPSG:4326'
